## 1. Resumo Executivo ‚Äî "Por que ABIntel?"

### Desafio vs Resultado

| **Desafio**                        | **Resultado da ABIntel (Comprovado em Produ√ß√£o)** |
| ---------------------------------- | ------------------------------------------------- |
| Dados em silos desconectados, sem equipe de ML | ‚úÖ Microsservi√ßos plug-and-play que ingerem transa√ß√µes, faturas, tickets, fluxos de sensores ou texto livre e entregam previs√µes acion√°veis em < 60s. |
| Tempo para gerar valor √© lento     | ‚úÖ Primeira campanha ou projeto de custos no ar em ‚â§ 2 horas; aumento t√≠pico de 6‚Äì14% no EBIT dentro de um trimestre fiscal. |
| Falta de expertise em GPU          | ‚úÖ Altern√¢ncia para GPU ou fallback seguro em CPU √© autom√°tica. |
| Passes entre Dados e Neg√≥cios      | ‚úÖ Cada resposta cont√©m narrativas em ingl√™s, espanhol e portugu√™s para que marketing, planejamento e finan√ßas entendam o "e da√≠?" instantaneamente. |

---

## 1.1 Arquitetura da Plataforma em Destaque

* üß© Kubernetes com autoscaling at√© **32√ó T4s** (ou **H100s no 4¬∫ tri de 2025**)
* üîê Auditoria SOC 2 Tipo 2 em progresso; datacenters certificados **ISO 27001**
* üöÄ **Canary releases** sem downtime
* üè∑Ô∏è Versionamento sem√¢ntico via `/v1`

---

## 1.2 Servidor da API

```
https://api-prod.abintel.app
```

---

## 1.3 Enfileirar uma Tarefa ‚Üí `POST /ai/{downstream_route}`

### Exemplo

```http
POST /api/v1/ai/forecast_revenue
```

#### Cabe√ßalhos

```http
X-Customer-Api-Id: 4d09ffe5-33d7-4a63-b4fd-fc1decf4fa8f
X-Secret: AfIqb2F9JNET_‚Ä¶HzHUa0w
```

#### Corpo

```json
{
  "region": "EU",
  "horizon": 12,
  "include_promotions": true
}
```

### Por tr√°s dos Bastidores

1. Proxy verifica seu plano ‚Üí mapeamento de fila (`Business ‚Üí tasks-medium`)
2. Valida se o caminho downstream √© permitido
3. Tarefa salva no **Cosmos DB** com `status: "queued"`
4. Um `UsageRecord` debitado
5. Job √© enfileirado no **Azure Service Bus**
6. Worker executa o modelo de IA ‚Üí grava `status: "completed"` no Cosmos DB

### Resposta (HTTP 202 - Queued)

```json
{
  "task_id": "c7d1b5e76c67485eab1c9a407f7e6a97",
  "queue": "tasks-medium",
  "status": "queued"
}
```

> üí° Dica: Tudo que voc√™ `POST` √© armazenado exatamente como enviado. √â poss√≠vel mandar objetos grandes e aninhados.

---

## 1.4 Verificar Status / Baixar Resultados

### 1.4.1 Listar Jobs Recentes

```http
GET /api/v1/taskadmin/tasks?status_filter=completed&limit=20
```

Mesmos cabe√ßalhos de autentica√ß√£o.

### 1.4.2 Buscar um Job

```http
GET /api/v1/taskadmin/tasks/{task_id}?part=response
```

#### Exemplo ‚Äì Sucesso

```json
{
  "auc": 0.912,
  "predictions": [ ... ],
  "interpretation": "Modelo XGBoost ‚Äì boa separa√ß√£o."
}
```

#### Exemplo ‚Äì Falha

```json
{
  "error": "HTTP 500 Server Error: ‚Ä¶",
  "status_code": 500
}
```

---

## 1.5 Dashboards de Fila e Workers

| **Endpoint**                  | **Uso**                                                         | **Exemplo** |
| ----------------------------- | ---------------------------------------------------------------- | ----------- |
| `GET /taskadmin/queue/stats`  | Resumo ‚Äì contagem de jobs enfileirados / conclu√≠dos / falhos por fila + job mais antigo | `GET /api/v1/taskadmin/queue/stats` |
| `GET /taskadmin/queue/queued` | Dump paginado para dashboards personalizados                     | `GET /api/v1/taskadmin/queue/queued?queue=medium` |

> üß† Ambos os endpoints consultam o Cosmos DB ‚Äì nenhum impacto nos workers.

---

## 1.6 APIs de Uso / Cobran√ßa

| Endpoint                       | Descri√ß√£o                             |
| ------------------------------ | ------------------------------------- |
| `GET /taskadmin/usage/month`   | Contagem de chamadas e custo do m√™s   |
| `GET /taskadmin/usage/history` | Hist√≥rico de uso e custo por m√™s      |

#### Exemplo de Resposta

```json
{
  "month": "2025-05",
  "calls": 842,
  "cost": 42.10
}
```

> üí∞ Custos s√£o derivados de `UsageRecord.cost`. √â poss√≠vel definir pre√ßos por rota.

---

## 1.7 Ciclo T√≠pico

```
sequenceDiagram
    Customer ->> Proxy /ai/... : POST payload
    Proxy ->> Cosmos DB : Save task (status="queued")
    Proxy ->> Azure Service Bus : Enqueue task
    Celery Worker ->> Azure Bus : Poll
    Worker ->> AI Backend : POST for processing
    Worker ->> Cosmos DB : Save (status="completed" + response)
    Customer ->> /taskadmin/tasks/{id}?part=response : Fetch result
```

---

## 1.8 Guia R√°pido de Tratamento de Erros

| **Status**  | **Significado**            | **Pr√≥ximo Passo**                         |
| ----------- | -------------------------- | ----------------------------------------- |
| `queued`    | Aguardando worker livre    | Verifique `/queue/stats` para backlog     |
| `completed` | Resultado pronto           | Fa√ßa o download                           |
| `failed`    | Erro ou timeout            | Inspecione o campo `error`; retente se transit√≥rio |

---

## 1.9 FAQ

* **Quanto tempo os resultados ficam dispon√≠veis?**
  ‚è≥ 30 dias (padr√£o)

* **Posso cancelar um job?**
  ‚ùå Ainda n√£o ‚Äì abra um ticket de suporte

* **Timeouts?**
  ‚è±Ô∏è Timeout r√≠gido de 60s; divida jobs grandes

* **Seguran√ßa?**
  üîê TLS 1.2 para todos os dados em tr√¢nsito
  üîí Segredos com hash em repouso

---
