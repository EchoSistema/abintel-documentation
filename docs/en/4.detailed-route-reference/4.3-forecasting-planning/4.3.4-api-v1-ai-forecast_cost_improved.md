# 4.3.4 /api/v1/ai/forecast_cost_improved

**Nine-month daily cost outlook**

### Purpose 
An extended variant of the generic_cost forecaster that also emits a Business Indicators block – perfect for Finance & FP&A dashboards.

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yml
POST https://api.abintel.ai/api/v1/ai/forecast_cost_improved
headers:
  X-Customer-Api-Id: <uuid>
  X-Secret: <secret>
  Content-Type: application/json
```

### What problem it solves

| Business pain-point                      | How the endpoint helps                                            |
| ---------------------------------------- | ----------------------------------------------------------------- |
| Need a longer horizon (up to 12 m)       | `forecast_period` now accepts 9+ months.                          |
| Want a one-line health read-out          | `business_indicators` summarises trend, volatility, CV, growth %. |
| Must reconcile calendar vs business days | Returns both roll-ups out-of-the-box.                             |

---

### Payload reference

| Path             | Type       | Req? | Purpose                  | Notes                            |
| ---------------- | ---------- | ---- | ------------------------ | -------------------------------- |
| forecast_period  | int ≥ 1    | ✔︎   | Months to project        | e.g. 9                           |
| data[]           | array      | ✔︎   | Historic daily cost rows | ≥ 60 rows for robust seasonality |
| ↳ date           | YYYY-MM-DD | ✔︎   | ISO calendar date        | gaps auto-filled at 0            |
| ↳ cost           | number     | ✔︎   | Cost amount              | currency agnostic                |


```json
{
  "forecast_period": 9,
  "data": [
    { "date": "2024-10-01", "cost": 950.00 },
    { "date": "2024-10-02", "cost": 956.00 },
    { "date": "2024-10-03", "cost": 962.00 },
    { "date": "2024-10-04", "cost": 968.00 },
    { "date": "2024-10-05", "cost": 921.00 },
    { "date": "2024-10-06", "cost": 915.00 },
    { "date": "2024-10-07", "cost": 975.00 },
    { "date": "2024-10-08", "cost": 981.00 },
    { "date": "2024-10-09", "cost": 987.00 },
    { "date": "2024-10-10", "cost": 993.00 },
    { "date": "2024-10-11", "cost": 999.00 },
    { "date": "2024-10-12", "cost": 952.00 },
    { "date": "2024-10-13", "cost": 946.00 },
    { "date": "2024-10-14", "cost": 1005.00 },
    { "date": "2024-10-15", "cost": 1011.00 },
    { "date": "2024-10-16", "cost": 1017.00 },
    { "date": "2024-10-17", "cost": 1023.00 },
    { "date": "2024-10-18", "cost": 1029.00 },
    { "date": "2024-10-19", "cost": 981.00 },
    { "date": "2024-10-20", "cost": 975.00 },

    { "date": "2024-11-01", "cost": 1040.00 },
    { "date": "2024-11-02", "cost": 995.00 },
    { "date": "2024-11-03", "cost": 988.00 },
    { "date": "2024-11-04", "cost": 1046.00 },
    { "date": "2024-11-05", "cost": 1052.00 },
    { "date": "2024-11-06", "cost": 1058.00 },
    { "date": "2024-11-07", "cost": 1064.00 },
    { "date": "2024-11-08", "cost": 1070.00 },
    { "date": "2024-11-09", "cost": 1019.00 },
    { "date": "2024-11-10", "cost": 1012.00 },
    { "date": "2024-11-11", "cost": 1078.00 },
    { "date": "2024-11-12", "cost": 1084.00 },
    { "date": "2024-11-13", "cost": 1090.00 },
    { "date": "2024-11-14", "cost": 1096.00 },
    { "date": "2024-11-15", "cost": 1102.00 },
    { "date": "2024-11-16", "cost": 1050.00 },
    { "date": "2024-11-17", "cost": 1043.00 },

    { "date": "2024-12-01", "cost": 1120.00 },
    { "date": "2024-12-02", "cost": 1127.00 },
    { "date": "2024-12-03", "cost": 1133.00 },
    { "date": "2024-12-04", "cost": 1140.00 },
    { "date": "2024-12-05", "cost": 1146.00 },
    { "date": "2024-12-06", "cost": 1152.00 },
    { "date": "2024-12-07", "cost": 1098.00 },
    { "date": "2024-12-08", "cost": 1091.00 },
    { "date": "2024-12-09", "cost": 1159.00 },
    { "date": "2024-12-10", "cost": 1165.00 },
    { "date": "2024-12-11", "cost": 1171.00 },
    { "date": "2024-12-12", "cost": 1177.00 },
    { "date": "2024-12-13", "cost": 1183.00 },
    { "date": "2024-12-14", "cost": 1128.00 },
    { "date": "2024-12-15", "cost": 1121.00 },

    { "date": "2025-01-01", "cost": 1195.00 },
    { "date": "2025-01-02", "cost": 1201.00 },
    { "date": "2025-01-03", "cost": 1207.00 },
    { "date": "2025-01-04", "cost": 1150.00 },
    { "date": "2025-01-05", "cost": 1143.00 },
    { "date": "2025-01-06", "cost": 1214.00 },
    { "date": "2025-01-07", "cost": 1220.00 },
    { "date": "2025-01-08", "cost": 1226.00 },
    { "date": "2025-01-09", "cost": 1233.00 },
    { "date": "2025-01-10", "cost": 1239.00 },
    { "date": "2025-01-11", "cost": 1182.00 },
    { "date": "2025-01-12", "cost": 1175.00 },
    { "date": "2025-01-13", "cost": 1245.00 },
    { "date": "2025-01-14", "cost": 1251.00 },
    { "date": "2025-01-15", "cost": 1257.00 },

    { "date": "2025-02-01", "cost": 1268.00 },
    { "date": "2025-02-02", "cost": 1260.00 },
    { "date": "2025-02-03", "cost": 1275.00 },
    { "date": "2025-02-04", "cost": 1281.00 },
    { "date": "2025-02-05", "cost": 1287.00 },
    { "date": "2025-02-06", "cost": 1293.00 },
    { "date": "2025-02-07", "cost": 1299.00 },
    { "date": "2025-02-08", "cost": 1241.00 },
    { "date": "2025-02-09", "cost": 1234.00 },
    { "date": "2025-02-10", "cost": 1305.00 },
    { "date": "2025-02-11", "cost": 1311.00 },
    { "date": "2025-02-12", "cost": 1317.00 },
    { "date": "2025-02-13", "cost": 1323.00 },
    { "date": "2025-02-14", "cost": 1329.00 },

    { "date": "2025-03-01", "cost": 1341.00 },
    { "date": "2025-03-02", "cost": 1333.00 },
    { "date": "2025-03-03", "cost": 1348.00 },
    { "date": "2025-03-04", "cost": 1354.00 },
    { "date": "2025-03-05", "cost": 1360.00 },
    { "date": "2025-03-06", "cost": 1366.00 },
    { "date": "2025-03-07", "cost": 1372.00 },
    { "date": "2025-03-08", "cost": 1312.00 },
    { "date": "2025-03-09", "cost": 1305.00 },
    { "date": "2025-03-10", "cost": 1378.00 },
    { "date": "2025-03-11", "cost": 1384.00 },
    { "date": "2025-03-12", "cost": 1390.00 },
    { "date": "2025-03-13", "cost": 1396.00 },
    { "date": "2025-03-14", "cost": 1402.00 },
    { "date": "2025-03-15", "cost": 1341.00 },
    { "date": "2025-03-16", "cost": 1334.00 },
    { "date": "2025-03-17", "cost": 1408.00 },
    { "date": "2025-03-18", "cost": 1414.00 },
    { "date": "2025-03-19", "cost": 1420.00 },
    { "date": "2025-03-20", "cost": 1426.00 },
    { "date": "2025-03-21", "cost": 1432.00 },
    { "date": "2025-03-22", "cost": 1371.00 },
    { "date": "2025-03-23", "cost": 1364.00 },
    { "date": "2025-03-24", "cost": 1438.00 },
    { "date": "2025-03-25", "cost": 1444.00 },
    { "date": "2025-03-26", "cost": 1450.00 },
    { "date": "2025-03-27", "cost": 1456.00 },
    { "date": "2025-03-28", "cost": 1462.00 },
    { "date": "2025-03-29", "cost": 1401.00 },
    { "date": "2025-03-30", "cost": 1394.00 },
    { "date": "2025-03-31", "cost": 1468.00 }
  ]
}
```

### How the engine chooses the “best algorithm”

1. Clean & enrich – fill missing dates, create weekday/holiday dummies, lag & MA features.

2. Model bake-off – ARIMA, STL-ETS, Prophet, TBATS, Gradient-Boost, Random-Forest, plus an Aggregation baseline that averages seasonal buckets (works surprisingly well on linear ramps).

3. Cross-validation – rolling-window CV → RMSE & MAE; lowest RMSE wins.

4. Indicators – trend slope, σ, CV, growth %, cumulative cost for the full horizon.

---

### Canonical response dissected


```json
{
    "forecast_period": 9,
    "forecast_result": {
        "analysis_type": "generic_cost",
        "best_algorithm": "Aggregation",
        "evaluation_metrics": {
            "RMSE": 26.572184922329946,
            "MAE": 21.84404110283987,
            "R2": 0.6666323266549463,
            "average_daily_cost": 1382.5775206313226,
            "Interpretation": "The Aggregation algorithm was selected because it achieved a low RMSE of 26.57, MAE of 21.84, and R² of 0.67. The average daily cost forecast is 1382.58."
        },
        "forecast": {
            "calendar": [
                {
                    "yyyy-mm": "2025-04",
                    "value": 43445.60577367302
                },
                {
                    "yyyy-mm": "2025-05",
                    "value": 44893.792632795456
                },
                {
                    "yyyy-mm": "2025-06",
                    "value": 43445.60577367302
                },
                {
                    "yyyy-mm": "2025-07",
                    "value": 44893.792632795456
                },
                {
                    "yyyy-mm": "2025-08",
                    "value": 44893.792632795456
                },
                {
                    "yyyy-mm": "2025-09",
                    "value": 43445.60577367302
                },
                {
                    "yyyy-mm": "2025-10",
                    "value": 44893.792632795456
                },
                {
                    "yyyy-mm": "2025-11",
                    "value": 43445.60577367302
                },
                {
                    "yyyy-mm": "2025-12",
                    "value": 44893.792632795456
                }
            ],
            "business": [
                {
                    "yyyy-mm": "2025-04",
                    "value": 31860.110900693548
                },
                {
                    "yyyy-mm": "2025-05",
                    "value": 31860.110900693548
                },
                {
                    "yyyy-mm": "2025-06",
                    "value": 30411.924041571114
                },
                {
                    "yyyy-mm": "2025-07",
                    "value": 33308.297759815985
                },
                {
                    "yyyy-mm": "2025-08",
                    "value": 30411.924041571114
                },
                {
                    "yyyy-mm": "2025-09",
                    "value": 31860.110900693548
                },
                {
                    "yyyy-mm": "2025-10",
                    "value": 33308.297759815985
                },
                {
                    "yyyy-mm": "2025-11",
                    "value": 28963.73718244868
                },
                {
                    "yyyy-mm": "2025-12",
                    "value": 33308.297759815985
                }
            ]
        },
        "business_indicators": {
            "historical_average_cost": 1194.37,
            "historical_cost_std": 157.88,
            "historical_coefficient_of_variation": 0.13,
            "historical_trend_slope": 4.783,
            "historical_trend_direction": "increasing",
            "forecast_cumulative_cost_calendar": 398251.39,
            "forecast_average_daily_cost_calendar": 1475.01,
            "forecast_cumulative_cost_business": 285292.81,
            "forecast_average_daily_cost_business": 1509.49,
            "forecast_growth_percentage": 23.5
        }
    },
    "execution_time_seconds": 0.2553369998931885
}
```

### Key take-aways

| Signal                  | Read-out                            | Action                                           |
|------------------------ |------------------------------------ |--------------------------------------------------|
| Trend slope +4.78       | Costs rising ≈ €4.8 per day.        | Investigate drivers (commodity, wage).           |
| CV 0.13                 | Low volatility.                     | Suitable for straight-line accruals.             |
| Forecast growth +23.5 % | 9-month calendar total vs trailing. | Feed to cash-flow & variance tracker.            |

---

### Power-user tips

- **Scenario overlays** – add `override_growth_pct` to shock the baseline (e.g. +10 % inflation).
- **Error bands** – set `"return_prediction_interval": true` to get 80 % & 95 % PI.
- **Cost centres** – batch 50+ series in one call via an array wrapper; each gets its own champion.
- **Alerting** – compare actuals to the PI; if two consecutive business days breach the 80 % upper band, trigger spend-freeze workflow.

---

### Next step

Schedule this endpoint monthly via your orchestration tool (Airflow, Prefect…). Push the business series into your rolling 13-week cash forecast. Combine the growth % indicator with revenue projections to maintain a dynamic gross-margin outlook.

---

