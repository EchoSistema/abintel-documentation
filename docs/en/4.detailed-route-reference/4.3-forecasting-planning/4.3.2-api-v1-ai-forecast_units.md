# 4.3.2 /api/v1/ai/forecast_units

## One-Shot SKU-Level Demand Forecast

## Purpose

Call once, get a 6-month, day-to-business-day unit forecast for an individual SKU – automatically benchmarks statistical & ML models and returns the winner with diagnostics.

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yml
POST https://api.abintel.ai/api/v1/ai/forecast_units
headers:
  X-Customer-Api-Id: <uuid>
  X-Secret: <secret>
  Content-Type: application/json
```

---

### When you’ll reach for it

| Business question                                         | How the route answers                                                                                  | Typical payoff                                 |
| --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------ | ---------------------------------------------- |
| “How many pieces should we replenish per SKU each month?” | Calendar & business-day unit forecast plus ±2 σ error band (not shown below).               | Cuts stock-out/over-stock cost without spreadsheet kung-fu|
| “Which model works for lumpy demand?”                     | Runs ARIMA, TBATS, Prophet, Random-Forest, Gradient Boost, Croston (intermittent) & picks lowest RMSE. | Gives Croston/ML without writing a line of code|
| “Ops wants the figure in pieces, not revenue.”            | Accepts sales_quantity straight from POS/OMS.                                                          | No price inflation noise                       |

---

### Request body – every key explained

| Path              | Type       | Req.? | Meaning                | Notes                       |
| ----------------- | ---------- | ----- | ---------------------- | --------------------------  |
| product_code      | string     | yes   | SKU or internal code   | Returned as-is in response  |
| forecast_period   | int ≥ 1    | yes   | Months to predict      | 3, 6, 12 typical            |
| data[]            | array      | yes   | Daily historical units | ≥ 45 rows recommended       |
| ↳ date            | YYYY-MM-DD | yes   | ISO calendar date      | Gaps auto-filled with 0     |
| ↳ sales_quantity  | int ≥ 0    | yes   | Units sold that day    | Same UoM entire series      |

```json
{
  "product_code": "38788",
  "forecast_period": 6,
  "data": [
    { "date": "2025-02-20", "sales_quantity": 11 },
    { "date": "2025-02-21", "sales_quantity": 12 },
    { "date": "2025-02-22", "sales_quantity": 6  },
    { "date": "2025-02-23", "sales_quantity": 5  },
    { "date": "2025-02-24", "sales_quantity": 14 },
    { "date": "2025-02-25", "sales_quantity": 13 },
    { "date": "2025-02-26", "sales_quantity": 12 },
    { "date": "2025-02-27", "sales_quantity": 13 },
    { "date": "2025-02-28", "sales_quantity": 12 },
    { "date": "2025-03-01", "sales_quantity": 7  },
    { "date": "2025-03-02", "sales_quantity": 6  },
    { "date": "2025-03-03", "sales_quantity": 15 },
    { "date": "2025-03-04", "sales_quantity": 14 },
    { "date": "2025-03-05", "sales_quantity": 13 },
    { "date": "2025-03-06", "sales_quantity": 14 },
    { "date": "2025-03-07", "sales_quantity": 13 },
    { "date": "2025-03-08", "sales_quantity": 7  },
    { "date": "2025-03-09", "sales_quantity": 6  },
    { "date": "2025-03-10", "sales_quantity": 16 },
    { "date": "2025-03-11", "sales_quantity": 15 },
    { "date": "2025-03-12", "sales_quantity": 14 },
    { "date": "2025-03-13", "sales_quantity": 15 },
    { "date": "2025-03-14", "sales_quantity": 14 },
    { "date": "2025-03-15", "sales_quantity": 8  },
    { "date": "2025-03-16", "sales_quantity": 7  },
    { "date": "2025-03-17", "sales_quantity": 16 },
    { "date": "2025-03-18", "sales_quantity": 15 },
    { "date": "2025-03-19", "sales_quantity": 14 },
    { "date": "2025-03-20", "sales_quantity": 15 },
    { "date": "2025-03-21", "sales_quantity": 14 },
    { "date": "2025-03-22", "sales_quantity": 7  },
    { "date": "2025-03-23", "sales_quantity": 6  },
    { "date": "2025-03-24", "sales_quantity": 17 },
    { "date": "2025-03-25", "sales_quantity": 16 },
    { "date": "2025-03-26", "sales_quantity": 15 },
    { "date": "2025-03-27", "sales_quantity": 16 },
    { "date": "2025-03-28", "sales_quantity": 15 },
    { "date": "2025-03-29", "sales_quantity": 8  },
    { "date": "2025-03-30", "sales_quantity": 7  },
    { "date": "2025-03-31", "sales_quantity": 17 },
    { "date": "2025-04-01", "sales_quantity": 16 },
    { "date": "2025-04-02", "sales_quantity": 15 },
    { "date": "2025-04-03", "sales_quantity": 16 },
    { "date": "2025-04-04", "sales_quantity": 15 },
    { "date": "2025-04-05", "sales_quantity": 8  },
    { "date": "2025-04-06", "sales_quantity": 7  },
    { "date": "2025-04-07", "sales_quantity": 18 },
    { "date": "2025-04-08", "sales_quantity": 17 },
    { "date": "2025-04-09", "sales_quantity": 16 },
    { "date": "2025-04-10", "sales_quantity": 17 },
    { "date": "2025-04-11", "sales_quantity": 16 },
    { "date": "2025-04-12", "sales_quantity": 9  },
    { "date": "2025-04-13", "sales_quantity": 8  },
    { "date": "2025-04-14", "sales_quantity": 18 },
    { "date": "2025-04-15", "sales_quantity": 17 },
    { "date": "2025-04-16", "sales_quantity": 16 },
    { "date": "2025-04-17", "sales_quantity": 17 },
    { "date": "2025-04-18", "sales_quantity": 16 },
    { "date": "2025-04-19", "sales_quantity": 9  },
    { "date": "2025-04-20", "sales_quantity": 8  }
  ]
}
```

---

### Behind the curtain

1. Cleaning – sort, fill missing dates (=0), Hampel filter outliers (kept but flagged).

2. Feature crafting – lag-7/14/28, promo/holiday flags (if extra cols present), rolling means.

3. Model zoo – Seasonal-ARIMA, STL-ETS, Prophet, TBATS, Random-Forest Regressor, Gradient-Boost, Croston for intermittent.

4. Cross-val – expanding window, score RMSE/MAE/R².

5. Champion – lowest RMSE (ties → lowest MAE).

6. Forecast – horizon = forecast_period * 30/30.4 calendar & biz-day splits.

7. Safety floor – clip negatives → 0.

8. Return JSON + run-time (seconds).

---

### Response

```json
{
    "forecast_period": 6,
    "forecasts": [
        {
            "product_code": "38788",
            "best_algorithm": "Random Forest",
            "evaluation_metrics": {
                "RMSE": 1.0094506384700848,
                "MAE": 0.9820119348244344,
                "R2": 0.9324114946213251,
                "average_daily_sales": 12.93465473184223,
                "Interpretation": "The Random Forest algorithm was selected because it achieved a low RMSE of 1.01, MAE of 0.98, and R² of 0.93. The average daily sales forecast is 12.93."
            },
            "forecast": {
                "calendar": [
                    {
                        "yyyy-mm": "2025-05",
                        "value": 435.7681071428571
                    },
                    {
                        "yyyy-mm": "2025-06",
                        "value": 420.22091666666665
                    },
                    {
                        "yyyy-mm": "2025-07",
                        "value": 443.83299999999997
                    },
                    {
                        "yyyy-mm": "2025-08",
                        "value": 426.7840714285714
                    },
                    {
                        "yyyy-mm": "2025-09",
                        "value": 429.2682619047619
                    },
                    {
                        "yyyy-mm": "2025-10",
                        "value": 442.8730714285714
                    }
                ],
                "business": [
                    {
                        "yyyy-mm": "2025-05",
                        "value": 362.24461904761904
                    },
                    {
                        "yyyy-mm": "2025-06",
                        "value": 347.66261904761905
                    },
                    {
                        "yyyy-mm": "2025-07",
                        "value": 378.9077619047619
                    },
                    {
                        "yyyy-mm": "2025-08",
                        "value": 345.62752380952384
                    },
                    {
                        "yyyy-mm": "2025-09",
                        "value": 364.3430238095238
                    },
                    {
                        "yyyy-mm": "2025-10",
                        "value": 377.94783333333334
                    }
                ]
            }
        }
    ],
    "execution_time_seconds": 1.5340442657470703
}
```

---

### Field

| Field                 | How to read                    | Action                                                                             |
| --------------------- | ------------------------------ | ---------------------------------------------------------------------------------- |
| best_algorithm        | Model with lowest RMSE.        | Track per-SKU – if it flips to Croston your item may have become slow-moving.      |
| average_daily_sales   | Mean of historical series.     | Quick reasonableness check: forecast shouldn’t diverge > ±30 % unless seasonality. |
| forecast.calendar[]   | Units incl. weekends/holidays. | Feed to S\&OP, supplier POs.                                                       |
| forecast.business[]   | Units excl. weekends.          | Feed to labour & picking slot planning.                                            |

---

### Common gotchas & pro tips

* Intermittent demand – ≥ 40 % zero days? The route auto-tests Croston & TSB – flag appears in `evaluation_metrics.model_candidates` (omit here for brevity).

* Promotions – add a boolean `promo` column; tree models ingest it, improving spikes.

* Multi-channel split – want web vs store? Call the endpoint separately per channel code.

* Very new SKUs – < 30 data points defaults to “Naïve mean” and adds `"note":"cold-start"` in metrics.

---

### Next step

Schedule the call on the 1st business day each month, write `forecast.business` into your ERP replenishment table, and compare actual vs forecast weekly; auto-trigger a re-forecast if absolute error > 20 % for two consecutive weeks.

---

