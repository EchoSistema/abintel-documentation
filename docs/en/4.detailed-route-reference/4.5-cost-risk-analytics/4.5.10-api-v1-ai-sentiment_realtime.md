# 4.5.10 /api/v1/ai/sentiment_realtime

### Instantly triage a single customer message

### Purpose
Use this low-latency endpoint when you need an on-the-spot read of a chat, tweet, review, or call transcript snippet. The service returns polarity, dominant emotion, extracted topics, and a helper ‚Äúpriority‚Äù hint so support agents can react before the user rage-quits.

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yaml
POST https://api.abintel.ai/api/v1/ai/sentiment_realtime
X-Customer-Api-Id: <uuid>  
X-Secret: <secret>  
Content-Type: application/json
```

---

### Payload formats

**Choose one of the two shortcuts below:**

| **Option**     | **Use-case**                             | **Required fields**            |
| -------------- | ---------------------------------------- | ------------------------------ |
| A. Plain text  | Quick ping from a bot or lightweight SDK | `text`                         |
| B. Rich record | You already store IDs / timestamps       | Either `text` or `record.text` |

---

### A‚ÄÇPlain-text payload

```json
{
  "text": "Checkout keeps crashing üò°"
}
```

---

### B‚ÄÇRecord payload (recommended)

```json
{
  "id": "msg-1042",
  "timestamp": "2025-05-21T14:07Z",
  "text": "App freezes after every photo upload. I'm furious!",
  "metadata": {
    "customer_id": "C-987",
    "channel":     "chat",
    "ticket_id":   "TCK-2025-1042"
  }
}
```
Tip: You may omit id and timestamp; the backend autogenerates them if absent.

---

### Real-time response

```json
{
  "analysis": {
    "id":         "msg-1042",
    "sentiment":  "negative",
    "emotion":    "anger",
    "score":      -0.80,
    "key_topics": [ "app freeze", "photo upload", "frustration" ],
    "interpretation": "Score -0.80 ‚Üí NEGATIVE (‚àí1‚Ä¶+1 scale)."
  },
  "interpretation": "Suggested priority: HIGH."
}
```

---

### Field glossary

| **Path**                | **Meaning**                                                                           |
| ----------------------- | ------------------------------------------------------------------------------------- |
| analysis.score          | Polarity score (continuous).                                                          |
| analysis.sentiment      | Discrete bucket from score (‚â§ -0.3 = negative, ‚â• 0.3 = positive, else neutral/mixed). |
| analysis.emotion        | Primary emotion from GoEmotions-style classifier.                                     |
| analysis.key_topics[]   | Top noun-phrases / hashtags extracted from the message.                               |
| interpretation          | Short human sentence with urgency heuristic (HIGH when negative + frustration/anger). |

---

### Under the hood

* Pre-processing ‚Äì emoji mapping, spelling normalisation, language auto-detection (non-English fallback to multilingual model).

* Sentiment & emotion ‚Äì distilled RoBERTa (<30 ms) delivers polarity & emotion.

* Topic extraction ‚Äì KeyBERT-lite pulls 1‚Äì to 3-gram noun phrases.

* Priority rule ‚Äì if score < -0.5 or contains anger/frustration, flag as HIGH.

---

### Best practices & hacks

| **Do**                           | **Why**                                          |
| -------------------------------- | ------------------------------------------------ |
| Stream every chat line           | Surfaces spikes of anger immediately.            |
| Keep emojis in place             | üò° and ‚ù§Ô∏è boost model accuracy.                 |
| Attach `metadata.channel`        | Enables slicing satisfaction by support channel. |
| Batch to `/api/sentiment_report` | Spot macro-trends weekly.                        |

---

**TL;DR** ‚Äì Fire a single JSON with the customer‚Äôs text to `/api/sentiment_realtime`; get back polarity, emotion, topics, and a one-liner telling your agent how urgent it is.
