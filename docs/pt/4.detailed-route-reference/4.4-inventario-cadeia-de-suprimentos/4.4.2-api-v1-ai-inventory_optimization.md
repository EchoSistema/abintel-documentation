# 4.4.2 /api/v1/ai/inventory_optimization
+> Nota: tradução gerada automaticamente a partir do inglês; revise antes de publicar.


**Find the sweet-spot between too much and too little stock**

### Objetivo
A single endpoint that converts raw purchases & sales into a rich inventory ledger, full KPI deck and aging dashboard.

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yml
POST `https://api.abintel.ai/api/v1/ai/inventory_optimization`
headers:
  X-Customer-Api-Id: <uuid>
  X-Secret: <secret>
  Content-Type: application/json
```

---

### Why this endpoint exists

| Pain-point                                               | What the route delivers                                                                                    |
| -------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| “How many units should I order & when?”                  | `stock_optimization_and_replenishment{}` → Re-order Point, Safety-Stock, EOQ & optimal order frequency.    |
| “Am I over-stocked‐or‐short against the sales plan?”     | `inventory_analysis.excess_or_shortfall_analysis` compares today’s stock with the entire forecast horizon. |
| “Need a single dashboard for demand trend, variability…” | `forecast_demand_analysis{}` – growth %, volatility, above/below-average months, exhaustion month.         |
| Finance wants profit impact of shortfalls                | `financial_analysis.shortfall_cost_details` converts lost units → lost margin.                             |
| Ops needs actionable alerts                              | `alerts{}` tell planners exactly what’s at risk.                                                           |

---

### Payload reference

| JSON path                                    | Type   | Req? | Purpose                   | Details                          |
| -------------------------------------------- | ------ | ---- | ------------------------- | -------------------------------- |
| inventory_last_position.closing_inventory    | number | ✔︎   | Current on-hand qty       | baseline for coverage & turnover |
| inventory_last_position.last_count_date      | date   | ✔︎   | Date of stock count       | ISO YYYY-MM-DD                   |
| inventory_last_position.warehouse            | string | ✔︎   | Location label            | free text                        |
| product_details                              | object | ✔︎   | Static SKU metadata       | echoed back                      |
| forecast[]                                   |  array | ✔︎   | Monthly demand projection | yyyy-mm, value                   |
| lead_time_days                               | number | ✔︎   | Replenishment lead time   | calendar days                    |
| daily_cost                                   | number | ✔︎   | Holding cost / unit / day | local currency                   |
| ordering_cost                                | number | ✔︎   | Cost per purchase order   | used in EOQ                      |
| sales_revenue                                | number | ✔︎   | Unit sell price           | for revenue ratio                |
| sales_profit                                 | number | ✔︎   | Unit contribution margin  | for shortfall loss               |
| buy_cost                                     | number | ✔︎   | Unit purchase cost        | inventory value                  |

Tip: supply ≥ 12 months of forecast for best EOQ & coverage logic.

---

### Minimal working example

```json
{
  "inventory_last_position": {
    "closing_inventory": 50000,
    "last_count_date": "2025-04-15",
    "warehouse": "Central-SP"
  },
  "product_details": {
    "product_code": "38788",
    "product_name": "Widget Pro XL",
    "category": "Industrial Components",
    "uom": "units",
    "supplier": "WidgetCo Brazil"
  },
  "forecast": [
    { "yyyy-mm": "2025-05", "value": 2500 },
    ⋯
    { "yyyy-mm": "2027-04", "value": 3450 }
  ],
  "lead_time_days": 15,
  "daily_cost": 0.12,
  "ordering_cost": 150,
  "sales_revenue": 75,
  "sales_profit": 25,
  "buy_cost": 30
}
```

### Canonical response (key parts)

```json
{
  "inventory_analysis": {
    "inventory_coverage_ratio": {
      "months_of_inventory": 15.79,
      "days_of_inventory": 473.68,
      "description": "On-hand ÷ average monthly demand."
    },
    "excess_or_shortfall_analysis": {
      "stock_status": "Shortfall",
      "difference": 26000
    }
  },
  "stock_optimization_and_replenishment": {
    "reorder_point": 1678.68,
    "safety_stock": 95.35,
    "economic_order_quantity": 510.17,
    "optimal_order_frequency": 45.27,
    "inventory_turnover_ratio": 1.52
  },
  "forecast_demand_analysis": {
    "average_monthly_demand": 3166.67,
    "average_forecast_growth_rate": 1.83,
    "forecast_variability": {
      "coefficient_of_variation": 0.141
    },
    "cumulative_demand_projection": {
      "exhaustion_month": "2026-09"
    }
  },
  "financial_analysis": {
    "inventory_value": 1500000,
    "shortfall_cost_details": {
      "shortfall_quantity": 26000,
      "profit_loss": 650000
    }
  },
  "alerts": {
    "stock_status_alert": "Alert: Stock Shortfall – immediate replenishment required."
  },
  "processing_info": {
    "processing_time_seconds": "0.005",
    "calculation_date": "2025-05-21"
  }
}
```

### Interpreting the sample

| What you learn          | Sample value       | Action                                                               |
| ----------------------- | ------------------ | -------------------------------------------------------------------- |
| Coverage                | 15.8 mo (474 days) | Looks ample, but cumulative demand shows shortfall later             |
| ROP                     | 1 679 u            | When projected balance drops to this level, place an order           |
| EOQ                     | 510 u              | Ideal order batch size to minimise total cost                        |
| Safety stock            | 95 u               | Covers 1.8 days at avg demand; low variability justifies lean buffer |
| Loss if not replenished | 650 k profit       | Quantifies urgency for finance & supply-chain                        |

---

### KPI (JSON path)

| KPI path                                                               | Technical meaning                      | Commercial meaning                                     |
| ---------------------------------------------------------------------- | -------------------------------------- | ------------------------------------------------------ |
| current_stock_level.closing_inventory                                  | Physical units on hand                 | Starting point for turnover & cash-tied-up discussions |
| inventory_coverage_ratio.months_of_inventory / days_of_inventory       | Stock ÷ avg monthly forecast (×30)     | How long you can keep selling before zero stock        |
| excess_or_shortfall_analysis.stock_status & difference                 | Compares stock to full forecast demand | Hidden lost-sales cost or excess carrying cost         |
| average_monthly_demand                                                 | Mean of forecast[].value              | Baseline for planning                                   |
| forecast_trends[].percentage_change                                    | MoM % delta                            | Demand acceleration signal                             |
| average_forecast_growth_rate                                           | Mean of MoM changes                    | Feed to revenue planning                               |
| seasonality_analysis.months_above_average                              | Month index > avg                      | Promo planning                                         |
| forecast_variability.coefficient_of_variation                          | std_dev ÷ mean                        | Safety stock guidance                                   |
| cumulative_demand_projection.exhaustion_month                          | First month demand > stock             | Deadline to order                                      |

---

### Replenishment Block

| KPI                        | Formula                                                          | Meaning                     |
| -------------------------- | ---------------------------------------------------------------- | --------------------------- |
| reorder_point              | (avg daily demand × lead-time) + safety_stock                    | PO trigger                  |
| safety_stock               | Z × σ(daily demand) × √lead-time (Z≈1.65)                        | Noise buffer                |
| economic_order_quantity    | √((2 × annual demand × ordering_cost) / holding_cost per unit)   | Cost-efficient batch size   |
| optimal_order_frequency    | cumulative demand ÷ EOQ                                          | Orders needed               |
| inventory_turnover_ratio   | forecast_period_demand ÷ current_stock                           | Sales cash conversion speed |

---

### Classification Block

| KPI path                       | Meaning                                          |
| ------------------------------ | ------------------------------------------------ |
| demand_classification.value    | Rule-based demand tier                           |
| turnover_classification.value  | Rule-based on stock velocity                     |
| criticality.value              | Combines turnover & shortfall to prioritise SKUs |

---

### Risk & Sensitivity

| KPI path                                          | What it tells you                     |
| ------------------------------------------------- | ------------------------------------- |
| demand_sensitivity_analysis.demand_sensitivity    | CV grouped to High/Med/Low            |
| additional_indicators.stock_out_risk              | Heuristic flag for sales & SLA impact |

---

### Money Block

| KPI path                              | Meaning                       |
| ------------------------------------- | ----------------------------- |
| financial_analysis.inventory_value    | Capital locked                |
| profit_margin_percent                 | Contribution %                |
| sales_to_inventory_ratio              | ROI metric                    |
| shortfall_cost_details.profit_loss    | Lost margin from missed sales |

---

### Alerts

* Auto-generated flag: "Alert: Stock Shortfall – immediate replenishment required."

---

### processing_info.processing_time_seconds

* Runtime: 0.005

---

### How to use the list

* Daily Ops: monitor ROP and auto-issue POs.

* Monthly S&OP: check forecast_variability, EOQ, seasonality.

* Quarterly Finance: review inventory_value, profit_loss, and sales_to_inventory_ratio.

---

#### Próximo Passo

* Create an automation that checks exhaustion_month weekly and warns 90 days in advance.

* Push ROP & EOQ into ERP/MRP for PO creation.

* Benchmark SKUs: average inventory_turnover_ratio and coefficient_of_variation to flag tuning candidates.

---

