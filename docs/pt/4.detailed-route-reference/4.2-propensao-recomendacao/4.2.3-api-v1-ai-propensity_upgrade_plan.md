# 4.2.3 /api/v1/ai/propensity_upgrade_plan
+> Nota: tradução gerada automaticamente a partir do inglês; revise antes de publicar.


---

### Purpose – Upsell-Ready Scores for Plan Upgrades

Predict each customer’s likelihood to upgrade from their current subscription tier to a more lucrative target tier during your next upsell push or in-app paywall.

Use cases:

* Prioritise CSM outreach or in-product nudges

* Forecast revenue upside before launching “Go Gold Now” offers

* Build look-alike audiences for acquisition

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yaml
POST  https://api-prod.abintel.ai/api/v1/ai/propensity_upgrade_plan
Headers
  X-Customer-Api-Id: <uuid>
  X-Secret:          <secret>
  Content-Type:      application/json
```

---

### Request Body – Schema & Field Guide

## Required Fields

| **Key**        | **Type / Range** | **Required** | **Meaning**             | **Notes / Source**        |
| -------------- | ---------------- | ------------ | ----------------------- | ------------------------- |
| `current_plan` | string           | yes          | Customer’s current tier | e.g., "Starter", "Silver" |
| `target_plan`  | string           | yes          | Tier to upsell to       | e.g., "Gold", "Pro"       |
| `customers`    | array<object>    | yes          | Customer records        | Pulled from CRM/CDP       |

---

### Customer Object Fields

| **Field**       | **Type** | **Required** | **Meaning**                          |
| --------------- | -------- | ------------ | ------------------------------------ |
| `customer_id`   | string   | yes          | CRM primary key                      |
| `features`      | object   | yes          | Flat numeric/categorical feature set |
| `label_upgrade` | 0 / 1    | optional     | 1 if upgraded in historical window   |

---

### Starter Feature Kit

| **Feature**                | **What it Captures**            | **Typical SQL / Metric**                |
| -------------------------- | ------------------------------- | --------------------------------------- |
| `months_on_current_plan`   | Upgrade timing urgency          | `DATEDIFF(MONTH, plan_start, snapshot)` |
| `storage_usage_pct`        | Capacity squeeze trigger        | `(used_storage / quota) * 100`          |
| `support_tickets_last_30d` | Support interactions / friction | `COUNT(Zendesk tickets)`                |

Feel free to add fields like `MRR`, `API_call_volume`, `project_count`, `NPS`, etc.

---

### Engine Workflow

1. Label check: ≥ 20 `label_upgrade = 1` and `0` required for model training.

2. AutoML: Tries Logistic Regression, RF, XGBoost, CatBoost (5-fold CV).

3. Calibrated output: Returns `P(upgrade = 1)` for each customer.

4. Tier mapping:

* Very High ≥ 0.90

* High ≥ 0.70

* Medium ≥ 0.40

* Low ≥ 0.20

* Very Low < 0.20

5. Interpretation: Each score includes a one-line summary.

---

### Example #1 – Not Enough Labels

```json
{
  "current_plan": "Silver",
  "target_plan": "Gold",
  "customers": [
    {
      "customer_id": "C-3001",
      "features": {
        "months_on_current_plan": 8,
        "storage_usage_pct": 92,
        "support_tickets_last_30d": 4
      },
      "label_upgrade": 1
    }
  ]
}
```

---

### Resposta

```json
{
  "predictions": [
    {
      "customer_id": "C-3001",
      "probability": null,
      "propensity_tier": "Very Low",
      "interpretation": "Very low propensity – deprioritise in current cycle."
    }
  ],
  "model_info": {
    "note": "not enough labelled rows to train (need ≥20 & both classes)"
  }
}
```

---

### Example #2 – Full Training & Scoring

(5,000 rows; 600 upgrades observed)

---

### Response Snippet

```json
{
  "predictions": [
    {
      "customer_id": "C-3088",
      "probability": 0.86,
      "propensity_tier": "High",
      "interpretation": "High propensity – push personalised upgrade offer."
    },
    {
      "customer_id": "C-3201",
      "probability": 0.18,
      "propensity_tier": "Low",
      "interpretation": "Low propensity – nurture, don’t discount."
    }
  ],
  "model_info": {
    "best_algorithm": "CatBoost",
    "roc_auc": 0.79,
    "selected_features": [
      "storage_usage_pct",
      "months_on_current_plan",
      "support_tickets_last_30d"
    ],
    "train_rows": 4500,
    "test_rows": 500
  }
}
```

---

### Response Field Glossary

| **Path**                    | **Type**      | **Meaning**                                | **Practical Use**                |
| --------------------------- | ------------- | ------------------------------------------ | -------------------------------- |
| `predictions[].probability` | float / null  | Likelihood of upgrade next cycle           | Rank and filter (≥ 0.7 = target) |
| `propensity_tier`           | enum          | Very High / High / Medium / Low / Very Low | CRM / ESP segmentation           |
| `interpretation`            | string        | Sales-friendly summary                     | Tooltips, email, CRM             |
| `model_info.best_algorithm` | string / null | Best AutoML model                          | Audit and reproducibility        |
| `model_info.roc_auc`        | float / null  | Holdout performance                        | Model quality tracking           |
| `model_info.note`           | string / null | Explanation if training skipped            | Alert data/ML team               |

---

### Commercial Playbooks

| **Scenario**        | **Action**                                                | **Lift**                           |
| ------------------- | --------------------------------------------------------- | ---------------------------------- |
| Usage-driven upsell | Auto-trigger in-app pop-up if tier = High + storage > 80% | +22% conversion vs. generic prompt |
| CSM queue           | Push Very High customers into CSM dashboards              | +15% expansion MRR                 |
| Email offer         | Send discounts to Medium–High only; suppress Very Low     | –38% promo cost, same revenue      |
| Pricing strategy    | Compare scores before/after price change                  | Data-driven elasticity measure     |

---

### Data & Ops Best Practices

* Label window: `label_upgrade = 1` if upgrade happened within 90 days after snapshot.

* Feature freshness: Daily update for storage_usage_pct.

* Multi-step ladders: Train per plan hop (e.g., Silver→Gold, Gold→Platinum).

* Model caching: Auto-caches model per `current_plan + target_plan` for 30 days.

---

### FAQ

| **Q**                                      | **A**                                                        |
| ------------------------------------------ | ------------------------------------------------------------ |
| Can I score multiple target plans at once? | No – one per request to avoid model confusion.               |
| Only 12 positive upgrades?                 | Expand window, group tiers, or request generic upsell model. |
| Downgrade prediction?                      | Use `/propensity_downgrade_plan` (beta).                     |
| GDPR?                                      | Hash `customer_id`; no other PII is required.                |
| Max batch size?                            | 100,000 rows or 20MB; async bulk support in Q4 2025.         |

---

### Próximo Passo

Pipe High and Very High propensities into your CSM and marketing tools. Trigger tailored upgrade journeys and watch expansion MRR grow—without blanketing your entire user base.

---

