# 4.3.1 /api/v1/ai/forecast_revenue
+> Nota: tradução gerada automaticamente a partir do inglês; revise antes de publicar.


## Objetivo
Generate a 12-month revenue outlook (calendar & business days), pick the best model automatically, and get back ready-to-plot numbers plus error diagnostics.

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yml
POST https://api.abintel.ai/api/v1/ai/forecast_revenue
headers:
  X-Customer-Api-Id: <uuid>
  X-Secret: <secret>
  Content-Type: application/json
```

---

### Why you’ll use it

| Business question                           | How the route helps                                                                                      | Typical win                        |
| ------------------------------------------- | -------------------------------------------------------------------------------------------------------- | ---------------------------------- |
| “How much cash do we book next quarter?”    | Outputs monthly forecast with 80 % & 95 % CIs (not shown in sample).                                     | Replaces xls extrapolations in 5 s |
| “Which model should we trust?”              | Benchmarks ARIMA, Prophet, ETS, TBATS, Aggregation (naïve), etc., selects the lowest RMSE automatically. | No data-science headcount needed   |
| “Ops wants both calendar & business views.” | Returns two matrices: one counting all days, one excluding weekends/holidays.                            | Direct feed into FP\&A dashboards  |

---

### Request body – every field

| Path             | Type       | Req.? | Meaning                  | Notes                                    |
| ---------------- | ---------- | ----- | ------------------------ | ---------------------------------------- |
| forecast_period  | int ≥ 1    | yes   | # months to predict      | Typical 6-, 12-, 18-month horizons       |
| data[]           | array      | yes   | Historical daily revenue | Needs ≥ 60 rows (≈ 2 months)             |
| ↳ date           | YYYY-MM-DD | yes   | Day in ISO format        | Gaps allowed; endpoint auto-fills zeroes |
| ↳ revenue        | float ≥ 0  | yes   | Gross revenue that day   | Same currency every row                  |

```json
{
  "forecast_period": 12,
  "data": [
    {"date": "2024-01-01", "revenue": 1000.0},
    {"date": "2024-01-02", "revenue": 1010.0},
    {"date": "2024-01-03", "revenue": 1020.0},
    {"date": "2024-01-04", "revenue": 1030.0},
    {"date": "2024-01-05", "revenue": 1040.0},
    {"date": "2024-01-06", "revenue": 824.0},
    {"date": "2024-01-07", "revenue": 832.0},
    {"date": "2024-01-08", "revenue": 1070.0},
    {"date": "2024-01-09", "revenue": 1080.0},
    {"date": "2024-01-10", "revenue": 1090.0},
    {"date": "2024-01-11", "revenue": 1100.0},
    {"date": "2024-01-12", "revenue": 1110.0},
    {"date": "2024-01-13", "revenue": 888.0},
    {"date": "2024-01-14", "revenue": 896.0},
    {"date": "2024-01-15", "revenue": 1140.0},
    {"date": "2024-01-16", "revenue": 1150.0},
    {"date": "2024-01-17", "revenue": 1160.0},
    {"date": "2024-01-18", "revenue": 1170.0},
    {"date": "2024-01-19", "revenue": 1180.0},
    {"date": "2024-01-20", "revenue": 952.0},
    {"date": "2024-01-21", "revenue": 960.0},
    {"date": "2024-01-22", "revenue": 1210.0},
    {"date": "2024-01-23", "revenue": 1220.0},
    {"date": "2024-01-24", "revenue": 1230.0},
    {"date": "2024-01-25", "revenue": 1240.0},
    {"date": "2024-01-26", "revenue": 1250.0},
    {"date": "2024-01-27", "revenue": 1016.0},
    {"date": "2024-01-28", "revenue": 1024.0},
    {"date": "2024-01-29", "revenue": 1280.0},
    {"date": "2024-01-30", "revenue": 1290.0},
    {"date": "2024-01-31", "revenue": 1300.0},
    {"date": "2024-02-01", "revenue": 1000.0},
    {"date": "2024-02-02", "revenue": 1010.0},
    {"date": "2024-02-03", "revenue": 808.0},
    {"date": "2024-02-04", "revenue": 816.0},
    {"date": "2024-02-05", "revenue": 1040.0},
    {"date": "2024-02-06", "revenue": 1050.0},
    {"date": "2024-02-07", "revenue": 1060.0},
    {"date": "2024-02-08", "revenue": 1070.0},
    {"date": "2024-02-09", "revenue": 1080.0},
    {"date": "2024-02-10", "revenue": 864.0},
    {"date": "2024-02-11", "revenue": 872.0},
    {"date": "2024-02-12", "revenue": 1110.0},
    {"date": "2024-02-13", "revenue": 1120.0},
    {"date": "2024-02-14", "revenue": 1130.0},
    {"date": "2024-02-15", "revenue": 1140.0},
    {"date": "2024-02-16", "revenue": 1150.0},
    {"date": "2024-02-17", "revenue": 920.0},
    {"date": "2024-02-18", "revenue": 928.0},
    {"date": "2024-02-19", "revenue": 1180.0},
    {"date": "2024-02-20", "revenue": 1190.0},
    {"date": "2024-02-21", "revenue": 1200.0},
    {"date": "2024-02-22", "revenue": 1210.0},
    {"date": "2024-02-23", "revenue": 1220.0},
    {"date": "2024-02-24", "revenue": 984.0},
    {"date": "2024-02-25", "revenue": 992.0},
    {"date": "2024-02-26", "revenue": 1250.0},
    {"date": "2024-02-27", "revenue": 1260.0},
    {"date": "2024-02-28", "revenue": 1270.0},
    {"date": "2024-02-29", "revenue": 1280.0},
    {"date": "2024-03-01", "revenue": 1000.0},
    {"date": "2024-03-02", "revenue": 800.0},
    {"date": "2024-03-03", "revenue": 808.0},
    {"date": "2024-03-04", "revenue": 1030.0},
    {"date": "2024-03-05", "revenue": 1040.0},
    {"date": "2024-03-06", "revenue": 1050.0},
    {"date": "2024-03-07", "revenue": 1060.0},
    {"date": "2024-03-08", "revenue": 1070.0},
    {"date": "2024-03-09", "revenue": 856.0},
    {"date": "2024-03-10", "revenue": 864.0},
    {"date": "2024-03-11", "revenue": 1100.0},
    {"date": "2024-03-12", "revenue": 1110.0},
    {"date": "2024-03-13", "revenue": 1120.0},
    {"date": "2024-03-14", "revenue": 1130.0},
    {"date": "2024-03-15", "revenue": 1140.0},
    {"date": "2024-03-16", "revenue": 912.0},
    {"date": "2024-03-17", "revenue": 920.0},
    {"date": "2024-03-18", "revenue": 1170.0},
    {"date": "2024-03-19", "revenue": 1180.0},
    {"date": "2024-03-20", "revenue": 1190.0},
    {"date": "2024-03-21", "revenue": 1200.0},
    {"date": "2024-03-22", "revenue": 1210.0},
    {"date": "2024-03-23", "revenue": 976.0},
    {"date": "2024-03-24", "revenue": 984.0},
    {"date": "2024-03-25", "revenue": 1240.0},
    {"date": "2024-03-26", "revenue": 1250.0},
    {"date": "2024-03-27", "revenue": 1260.0},
    {"date": "2024-03-28", "revenue": 1270.0},
    {"date": "2024-03-29", "revenue": 1280.0},
    {"date": "2024-03-30", "revenue": 1048.0}
  ]
}
```

---

### What happens under the hood

1. Pre-process – sort, fill missing days → 0 revenue, detect outliers (IQR winsorise), box-cox if needed.

2. Model zoo – ARIMA, STL-ETS, Prophet, TBATS, Croston (if > 40 % zeros) + Aggregation benchmark.

3. Cross-validation – rolling origin (4 folds) scoring RMSE & MAPE.

4. Champion select – lowest weighted RMSE (calendar 0.6 × business 0.4).

5. Post-process – make sure predictions ≥ 0; re-add outliers if suppressed.

6. Return forecast + error table + run-time.

Average latency: ~0.3 s on 90 days history; scales linearly.

---

### Resposta

```json
{
    "forecast_period": 12,
    "forecast_result": {
        "analysis_type": "generic_revenue",
        "best_algorithm": "Aggregation",
        "evaluation_metrics": {
            "RMSE": 111.63593256467632,
            "MAE": 109.6766254147977,
            "R2": 0.09176299947242217,
            "average_daily_revenue": 1105.017787752007,
            "Interpretation": "The Aggregation algorithm was selected because it achieved a low RMSE of 111.64, MAE of 109.68, and R² of 0.09. The average daily revenue forecast is 1105.02."
        },
        "forecast": {
            "calendar": [
                {
                    "yyyy-mm": "2024-04",
                    "value": 35509.98094676594
                },
                {
                    "yyyy-mm": "2024-05",
                    "value": 36693.6469783248
                },
                {
                    "yyyy-mm": "2024-06",
                    "value": 35509.98094676594
                },
                {
                    "yyyy-mm": "2024-07",
                    "value": 36693.6469783248
                },
                {
                    "yyyy-mm": "2024-08",
                    "value": 36693.6469783248
                },
                {
                    "yyyy-mm": "2024-09",
                    "value": 35509.98094676594
                },
                {
                    "yyyy-mm": "2024-10",
                    "value": 36693.6469783248
                },
                {
                    "yyyy-mm": "2024-11",
                    "value": 35509.98094676594
                },
                {
                    "yyyy-mm": "2024-12",
                    "value": 36693.6469783248
                },
                {
                    "yyyy-mm": "2025-01",
                    "value": 36693.6469783248
                },
                {
                    "yyyy-mm": "2025-02",
                    "value": 33142.64888364821
                },
                {
                    "yyyy-mm": "2025-03",
                    "value": 36693.6469783248
                }
            ],
            "business": [
                {
                    "yyyy-mm": "2024-04",
                    "value": 26040.652694295022
                },
                {
                    "yyyy-mm": "2024-05",
                    "value": 27224.31872585389
                },
                {
                    "yyyy-mm": "2024-06",
                    "value": 23673.320631177296
                },
                {
                    "yyyy-mm": "2024-07",
                    "value": 27224.31872585389
                },
                {
                    "yyyy-mm": "2024-08",
                    "value": 26040.652694295022
                },
                {
                    "yyyy-mm": "2024-09",
                    "value": 24856.98666273616
                },
                {
                    "yyyy-mm": "2024-10",
                    "value": 27224.31872585389
                },
                {
                    "yyyy-mm": "2024-11",
                    "value": 24856.98666273616
                },
                {
                    "yyyy-mm": "2024-12",
                    "value": 26040.652694295022
                },
                {
                    "yyyy-mm": "2025-01",
                    "value": 27224.31872585389
                },
                {
                    "yyyy-mm": "2025-02",
                    "value": 23673.320631177296
                },
                {
                    "yyyy-mm": "2025-03",
                    "value": 24856.98666273616
                }
            ]
        }
    },
    "execution_time_seconds": 0.268125057220459
}
```

---

### Field

| Field                | How to read                                | Action                                                             |
| -------------------- | ------------------------------------------ | -----------------------------------------------------------------  |
| best_algorithm       | Model with lowest cross-val error.         | Track changes – if it flips often you may have structural breaks.  |
| evaluation_metrics   | RMSE / MAE (absolute), R² (explained var.) | MAE ≤ 10 % of mean ⇒ “good”; else inspect seasonality or promos   |
| forecast.calendar[]  | Revenue including weekends & holidays.     | Feed to top-line board decks.                                      |
| forecast.business[]  | Revenue excluding weekends/holidays.       | Feed to capacity & staffing planning.                              |

---

### Power-user tips

* Promo bumps – send an extra boolean column `promo_day`: the API auto-segments regime switches (beta preview).

* Currency roll-ups – if you mix multi-currency streams, convert externally first; endpoint expects single unit.

* Edge series (< 60 pts) – fallback to “Aggregation” by design → consider weekly aggregation then re-call.

* Scenario testing – call twice: once full history, once minus last promo month → quantify uplift delta.

---

### Próximo Passo
Run the endpoint weekly, store `forecast.calendar` in your BI layer, and chart actual vs forecast. Alert finance if ±10 % deviation materialises for two consecutive weeks — teams can re-allocate paid-media budget in-flight.

---

