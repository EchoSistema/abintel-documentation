# 4.5.8 /api/v1/ai/anomaly_graph
+> Nota: traducción generada automáticamente desde el inglés; revisar antes de publicar.


### Expose suspicious “hub” nodes in any interaction network

### Propósito
Drop an edge list (device ↔ account, IP ↔ email, wallet ↔ merchant…) and the endpoint returns which nodes sit at the abnormal centre of activity given a simple degree-based heuristic.  
The logic is pluggable – if the container finds networkx + stellargraph, it can be upgraded to deep-graph embeddings without changing your payload.

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yaml
POST https://api.abintel.ai/api/v1/ai/anomaly_graph  
X-Customer-Api-Id: <uuid>  
X-Secret: <secret>  
Content-Type: application/json
```

---

### What problem does this solve?

| **Question you ask**                                     | **Where the answer is**                                  |
| -------------------------------------------------------- | -------------------------------------------------------- |
| “Which accounts / devices / IPs look way too connected?” | `details[].flag == true` (rank by `anomaly_score`)       |
| “How aggressive is the cut-off?”                         | `interpretation` – shows score threshold & contamination |

---

**Common uses:**

* Mule-account rings in payments

* Botnet controller nodes in infrastructure logs

* Credential-stuffing sources that hammer many victims

---

### Request payload schema

| **Path**      | **Type**      | **Req?** | **Description**                                |
| ------------- | ------------- | -------- | ---------------------------------------------- |
| contamination | number (0–1)  | ✔︎       | Fraction of nodes to flag (top-N by degree).   |
| edges[]       | array<object> | ✔︎       | One row per interaction. Order doesn’t matter. |
| ↳ src         | string        | ✔︎       | Origin node ID.                                |
| ↳ dst         | string        | ✔︎       | Destination node ID.                           |
| ↳ weight      | number        | optional | Strength / frequency (default = 1).            |

Only need one direction. The API treats the graph as undirected unless you send `"directed": true`.

---

### Request Example

```json
{
  "contamination": 0.10,
  "edges": [
    { "src": "acct-001", "dst": "acct-002", "weight": 1 },
    { "src": "acct-002", "dst": "acct-003", "weight": 1 },
    { "src": "acct-003", "dst": "acct-004", "weight": 5 },
    { "src": "acct-003", "dst": "acct-005", "weight": 4 },
    { "src": "acct-004", "dst": "acct-006", "weight": 3 },
    { "src": "acct-004", "dst": "acct-007", "weight": 3 },
    { "src": "acct-004", "dst": "acct-008", "weight": 3 },
    { "src": "acct-002", "dst": "acct-008", "weight": 1 },
    { "src": "acct-007", "dst": "acct-001", "weight": 1 }
  ]
}
```

---

### Response Example

```json
{
  "details": [
    { "node": "acct-001", "anomaly_score": 2.0, "flag": false },
    { "node": "acct-002", "anomaly_score": 3.0, "flag": false },
    { "node": "acct-003", "anomaly_score": 10.0, "flag": false },
    { "node": "acct-004", "anomaly_score": 14.0, "flag": true },
    { "node": "acct-005", "anomaly_score": 4.0, "flag": false },
    { "node": "acct-006", "anomaly_score": 3.0, "flag": false },
    { "node": "acct-007", "anomaly_score": 4.0, "flag": false },
    { "node": "acct-008", "anomaly_score": 4.0, "flag": false }
  ],
  "interpretation": "1 nodes flagged (threshold 11.20, contamination=0.1)."
}
```

---

### Field cheat-sheet

| **Field**        | **Meaning**                                                    |
| ---------------- | -------------------------------------------------------------- |
| `anomaly_score`  | Weighted degree of the node (sum of edge weights).             |
| `flag`           | `true` if `anomaly_score` ≥ threshold.                         |
| `interpretation` | Human summary — flagged count, threshold, contamination recap. |

---

### Under the hood

* Graph build → coalesce multiple edges, treat as undirected.

* Score → `degree(node)` = Σ weights.

* Threshold → top `contamination × |V|` nodes.

* Return → sorted list descending by score.

If **stellargraph** is available, the model switches to graph-SAGE embeddings + Isolation-Forest (same API response).

---

### Using the results

| **Action**                   | **Why**                                                                  |
| ---------------------------- | ------------------------------------------------------------------------ |
| Investigate high-score nodes | They interact with many distinct entities – potential fraud/bot control. |
| Tune contamination           | `0.02` for strict review, `0.20` for broader detection sweeps.           |
| Enrich the edge list         | Add edge weights like `#transactions` or `bytes transferred`.            |
| Iterate                      | Use confirmed cases in `/api/anomaly_accounts` to blend signals.         |

---

### Take-away:
`/api/anomaly_graph` is your quick radar for over-connected nodes in any relationship graph – ideal for detecting mule hubs, spam emitters, or compromised devices without custom graph ML.

---

