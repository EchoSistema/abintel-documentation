# 4.5.7 /api/v1/ai/anomaly_accounts
+> Nota: traducción generada automáticamente desde el inglés; revisar antes de publicar.


**Spot risky or compromised user profiles in one shot**

### Propósito
Push a batch of customer / account descriptors in, get back a ranked list of which profiles look off-pattern and the model quality on any rows you’ve already labelled.

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yaml
POST https://api.abintel.ai/api/v1/ai/anomaly_accounts
headers:
X-Customer-Api-Id: <uuid>
X-Secret: <secret>
Content-Type: application/json
```

---

### What this route answers

| **Business question**                                  | **Where to look in the response**                                 |
| ------------------------------------------------------ | ----------------------------------------------------------------- |
| “Which accounts should my trust-&-safety team review?” | `details[].fraud_flag = true` (plus `anomaly_score` for ranking). |
| “Is the model actually separating fakes from reals?”   | `kpi.auc` (ROC-AUC on the subset that has label).                 |
| “How many accounts are being flagged?”                 | `kpi.detected_pct` – share of rows above the threshold.           |

---

### Request payload schema

| **Path**      | **Type**      | **Req?** | **Description**                                                              |
| ------------- | ------------- | -------- | ---------------------------------------------------------------------------- |
| contamination | number (0–1)  | ✔︎       | Your expected % of anomalous accounts in this batch. Sets the score cut-off. |
| rows[]        | array<object> | ✔︎       | One object per account / customer.                                           |
| ↳ id          | string        | ✔︎       | Stable account identifier.                                                   |
| ↳ features    | object        | ✔︎       | Any metrics — counts, rates, booleans, categoricals (auto one-hot).          |
| ↳ label       | 0 / 1         | optional | 1 = confirmed fraud/bot, 0 = legit. Leave out if unknown.                    |

Tip More behavioural signals ≈ sharper separation.
Log-ins per day, failed payments, IP diversity, chargeback rate, last-seen device… all help.

---

### Request Example

```json
{
  "contamination": 0.05,
  "rows": [
    {
      "id": "acct-001",
      "features": {
        "age_days": 730,
        "num_logins": 120,
        "avg_txn": 45.2,
        "device_os": "ios",
        "2fa_enabled": 1
      },
      "label": 0
    },
    {
      "id": "acct-002",
      "features": {
        "age_days": 14,
        "num_logins": 75,
        "avg_txn": 3.1,
        "device_os": "android",
        "2fa_enabled": 0
      }
    },
    {
      "id": "acct-003",
      "features": {
        "age_days": 1,
        "num_logins": 350,
        "avg_txn": 0.0,
        "device_os": "windows",
        "2fa_enabled": 0
      },
      "label": 1
    },
    {
      "id": "acct-004",
      "features": {
        "age_days": 3,
        "num_logins": 280,
        "avg_txn": 999.9,
        "device_os": "linux",
        "2fa_enabled": 0
      }
    }
  ]
}
```

---

### Response Example

```json
{
  "kpi": {
    "detected_pct": 75.0,
    "auc": 0.6666666666666667
  },
  "details": [
    { "id": "acct-001", "anomaly_score": -0.0825, "fraud_flag": true },
    { "id": "acct-002", "anomaly_score": -0.0825, "fraud_flag": true },
    { "id": "acct-003", "anomaly_score": -0.0825, "fraud_flag": true },
    { "id": "acct-004", "anomaly_score": -0.0825, "fraud_flag": false }
  ],
  "interpretation": "75.0% of records flagged by LOF. Threshold=-0.0825 (quantile 0.95)."
}
```

---

### What the auc field means

| **Field** | **Meaning**                                                                                   |
| --------- | --------------------------------------------------------------------------------------------- |
| `auc`     | Area Under the ROC Curve (AUROC). Measures how well the model separates label=1 from label=0. |

---

* 0.5 → random guessing

* > 0.7 → decent separation

* > 0.9 → excellent

* Only returned if your payload has both label = 0 and label = 1 rows.


### Example:
**auc = 0.667 ⇒** the LOF model separates fraud from legit a bit better than random (66.7% of the time a fraud score is higher than a legit one).

----

### Field cheat-sheet

| **Field**          | **Meaning**                                                                                    |
| ------------------ | ---------------------------------------------------------------------------------------------- |
| `anomaly_score`    | Higher (less negative/more positive) ⇒ further from the normal cluster. Scale varies by model. |
| `fraud_flag`       | `true` if score ≥ threshold (where threshold = (1 − contamination) quantile).                  |
| `kpi.detected_pct` | % of accounts flagged in this call.                                                            |
| `kpi.auc`          | AUROC – only present with labelled data.                                                       |
| `interpretation`   | Human-readable summary of model used, share flagged, and threshold applied.                    |

---

### Behind the scenes

* Pre-processing – One-hot encoding of categoricals, robust scaling of numerics.

* Model bake-off – Isolation-Forest, Local Outlier Factor, Auto-Encoder.

* Winner = highest AUC (fallback to Isolation-Forest if no labels).

* Cut-off = score quantile (1 - contamination).

* Packaging – KPIs + verdicts returned per account.

---

### Using the output

| **Next step**                      | **Why**                                                   |
| ---------------------------------- | --------------------------------------------------------- |
| Sort by `anomaly_score` descending | Review the weirdest profiles first.                       |
| Add `label` from analyst feedback  | Improves model selection and future `auc`.                |
| Tune `contamination`               | Lower = stricter queue; higher = exploratory mode.        |
| Add richer features                | Best lever to increase recall and reduce false positives. |

---

### Bottom line:
`/api/anomaly_accounts` turns raw account metrics into a prioritized queue for your fraud ops or trust-&-safety team — no bespoke ML pipeline required.

---

