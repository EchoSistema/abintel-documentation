# 4.2.5 /api/v1/ai/recommend_similar_items
+> Nota: traducción generada automáticamente desde el inglés; revisar antes de publicar.


### Propósito

Return the K most similar catalogue items for a given reference SKU by blending collaborative-filter (CF) co-view signals with content-based vector similarity.

Ideal for:

* PDP widgets (“You may also like”)

* Search fallbacks

* Out-of-stock redirects

* Automatic cross-sell bundles

---

### Headers `X-Customer-Api-Id`, `X-Secret`

```yaml
POST  https://api-prod.abintel.ai/api/v1/ai/recommend_user_items
Headers
  X-Customer-Api-Id: <uuid>
  X-Secret:          <secret>
  Content-Type:      application/json
```

---

### Business Value

| **Use Case**                | **Benefit**                                         |
| --------------------------- | --------------------------------------------------- |
| PDP carousel                | +6–12% add-to-cart on long-tail SKUs                |
| Out-of-stock redirect       | Recover 30–40% of lost sessions                     |
| Bundle builder / cross-sell | Lift AOV 8–15% with automatic accessory suggestions |
| Category discovery          | Boost SEO dwell time and pages/session              |

---

### Request Body – Schema

## Top-level keys

| **Key**        | **Type / Range** | **Required?** | **Meaning**                        | **Notes**                                      |
| -------------- | ---------------- | ------------- | ---------------------------------- | ---------------------------------------------- |
| `item_id`      | string           | yes           | SKU to get look-alikes for         | Must exist in `items[]`                        |
| `top_k`        | int (1–100)      | optional      | Number of similar items to return  | Default: 10. Use 4–8 for desktop; 12–16 mobile |
| `items`        | array<object>    | yes           | Catalogue to rank from             | Candidate items                                |
| `interactions` | array<object>    | optional      | User-item historical data (for CF) | 1,000+ rows recommended                        |
| `blend_cf`     | float (0–1)      | optional      | Weight for collaborative filtering | Default: 0.5 (50/50 blend)                     |

---

### items[] structure

| **Key**    | **Type** | **Required?** | **Notes**                       |
| ---------- | -------- | ------------- | ------------------------------- |
| `item_id`  | string   | yes           | SKU                             |
| `metadata` | string   | optional      | Keywords (e.g. brand, category) |

---

### interactions[] structure

| **Key**   | **Type** | **Required?** | **Notes**                         |
| --------- | -------- | ------------- | --------------------------------- |
| `user_id` | string   | yes           | —                                 |
| `item_id` | string   | yes           | Must match an `items[]` entry     |
| `rating`  | float    | optional      | 0–5. Omitted = implicit +1 rating |

---

### How It Works

## When `interactions` are included:

1. Content similarity

* Uses TF-IDF vectorisation on `metadata`

* Scores via cosine similarity

2. Collaborative filtering (CF)

* ALS (30 dims, 20 iterations)

* Requires ≥ 75 users × 50 items

3. Blending

final_score = blend_cf * cf_score + (1 – blend_cf) * content_score

* Items without CF data use cf_score = 0.
  
4. Filter & Rank

* Exclude item_id from results

* Return top k by final_score

## Average latency:

* 80 ms (with CF)

* 20 ms (content-only)

---

### Example Request

```json
{
  "item_id": "SKU-A1",
  "top_k": 4,
  "items": [
    {"item_id": "SKU-A1", "metadata": "Running shoes, Nike, men"},
    {"item_id": "SKU-B9", "metadata": "Trail shoes, Adidas, women"},
    {"item_id": "SKU-C3", "metadata": "Soccer ball, size 5"},
    {"item_id": "SKU-D7", "metadata": "Compression socks, unisex"},
    {"item_id": "SKU-E2", "metadata": "Fitness smartwatch"}
  ],
  "interactions": [
    {"user_id": "U-42", "item_id": "SKU-A1"},
    {"user_id": "U-42", "item_id": "SKU-B9"},
    {"user_id": "U-17", "item_id": "SKU-A1"},
    {"user_id": "U-17", "item_id": "SKU-D7"}
  ],
  "blend_cf": 0.7
}
```

---

### Ejemplo de Respuesta

```json
{
  "recommendations": [
    {
      "item_id": "SKU-B9",
      "score": 0.1783,
      "source": "content",
      "explanation": "Shares similar attributes/keywords with the reference item."
    },
    ...
  ],
  "model_info": {
    "algorithm": "TF-IDF cosine",
    "metric": "cosine_sim",
    "value": 1.0,
    "train_rows": 5
  }
}
```

---

### Field Reference

| **Path**                        | **Type**     | **Meaning**                    | **Use**                                |
| ------------------------------- | ------------ | ------------------------------ | -------------------------------------- |
| `recommendations[].item_id`     | string       | Similar SKU                    | PDP carousel, alternate SKUs           |
| `recommendations[].score`       | float (0–1)  | Final blended score            | Sort or blend with business logic      |
| `recommendations[].source`      | enum         | `cf`, `content`, or `blend`    | Debug or analytics                     |
| `recommendations[].explanation` | string       | Reason text                    | Tooltip or UI label                    |
| `model_info.algorithm`          | string       | Engine used                    | Audit                                  |
| `model_info.metric/value`       | string/float | Fit quality                    | Model health, drift detection (future) |
| `model_info.train_rows`         | int          | Interactions used for training | Data volume confidence                 |

---

### Commercial Playbooks

| **Surface**           | **Implementation**                              | **KPI Impact**           |
| --------------------- | ----------------------------------------------- | ------------------------ |
| PDP Widget            | Call server-side; cache per SKU for 24h         | +8–15% add-to-cart       |
| Search No-Result      | Recommend alternatives when query fails         | Recover 20–30% drop-offs |
| Out-of-Stock Fallback | Swap unavailable SKU for top 3 look-alikes      | Saves 40% lost sessions  |
| Dynamic Bundles       | Suggest lower-priced accessories on cart > \$50 | +10% attach rate         |

---

### Engineering & Ops Tips

* Metadata: Strip stop-words for clarity.

* Brand weighting: Repeat key attributes to boost TF-IDF `(e.g., "Nike Nike")`.

* Cold start: Provide rich metadata to compensate for no interactions.

* Model freshness: Retrain TF-IDF nightly as catalogue changes.

* Latency: Cache CF model in memory and refresh hourly.

---

### FAQ

| **Q**                          | **A**                                                         |
| ------------------------------ | ------------------------------------------------------------- |
| Can I disable CF?              | Yes — set `"blend_cf": 0` or omit `interactions`.             |
| What if the item is brand-new? | CF score = 0; fallback to content-only.                       |
| Max catalogue size?            | 1M items / \~20 MB JSON. Use gzip & HTTP/2.                   |
| Multi-language metadata?       | Works language-agnostic. Tokenisation required for CN/JP.     |
| GDPR?                          | Only hashed `user_id` if using `interactions`. No PII stored. |

---

### Próximo Paso

Integrate this into your PDP or dynamic widget, cache for 24h per SKU, and run an A/B test vs. your static “similar items” list.

Expect double-digit cross-sell revenue lift in week one.

---

