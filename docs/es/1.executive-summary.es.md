## 1. Resumen Ejecutivo â€” "Â¿Por quÃ© ABIntel?"

### DesafÃ­o vs Resultado

| **DesafÃ­o**                       | **Resultado de ABIntel (Probado en ProducciÃ³n)** |
| --------------------------------- | ------------------------------------------------ |
| Datos en silos desconectados, sin equipo de ML | âœ… Microservicios plug-and-play que ingieren transacciones, facturas, tickets, flujos de sensores o texto libre y entregan predicciones accionables en < 60â€¯s. |
| Tiempo para generar valor lento   | âœ… Primera campaÃ±a o proyecto de costos en â‰¤ 2 horas; aumento tÃ­pico de 6â€“14â€¯% en EBIT dentro de un trimestre fiscal. |
| Falta de experiencia en GPU       | âœ… El cambio a GPU o el fallback seguro en CPU es automÃ¡tico. |
| Transferencias entre Datos y Negocio | âœ… Cada respuesta incluye narrativas en inglÃ©s, espaÃ±ol y portuguÃ©s para que marketing, planificaciÃ³n y finanzas entiendan el "Â¿y quÃ©?" al instante. |

---

## 1.1 Arquitectura de la Plataforma en Resumen

* ğŸ§© Kubernetes con autoscaling hasta **32Ã— T4s** (o **H100s en el Q4 de 2025**)
* ğŸ” AuditorÃ­a SOC 2 Tipo 2 en progreso; centros de datos certificados **ISO 27001**
* ğŸš€ **Canary releases** sin tiempo de inactividad
* ğŸ·ï¸ Versionado semÃ¡ntico mediante `/v1`

---

## 1.2 Servidor de la API

```
https://api-prod.abintel.app
```

---

## 1.3 Encolar una Tarea â†’ `POST /ai/{downstream_route}`

### Ejemplo

```http
POST /api/v1/ai/forecast_revenue
```

#### Encabezados

```http
X-Customer-Api-Id: 4d09ffe5-33d7-4a63-b4fd-fc1decf4fa8f
X-Secret: AfIqb2F9JNET_â€¦HzHUa0w
```

#### Cuerpo

```json
{
  "region": "EU",
  "horizon": 12,
  "include_promotions": true
}
```

### Tras Bambalinas

1. El proxy verifica tu plan â†’ mapeo de cola (`Business â†’ tasks-medium`)
2. Comprueba si la ruta downstream estÃ¡ permitida
3. La tarea se guarda en **Cosmos DB** con `status: "queued"`
4. Se debita un `UsageRecord`
5. El trabajo se encola en **Azure Service Bus**
6. El worker ejecuta el modelo de IA â†’ escribe `status: "completed"` en Cosmos DB

### Respuesta (HTTP 202 - Queued)

```json
{
  "task_id": "c7d1b5e76c67485eab1c9a407f7e6a97",
  "queue": "tasks-medium",
  "status": "queued"
}
```

> ğŸ’¡ Consejo: Todo lo que envÃ­es por `POST` se almacena exactamente como lo enviaste. Puedes mandar objetos grandes y anidados.

---

## 1.4 Verificar Estado / Descargar Resultados

### 1.4.1 Listar Trabajos Recientes

```http
GET /api/v1/taskadmin/tasks?status_filter=completed&limit=20
```

Mismos encabezados de autenticaciÃ³n.

### 1.4.2 Recuperar un Trabajo

```http
GET /api/v1/taskadmin/tasks/{task_id}?part=response
```

#### Ejemplo â€“ Ã‰xito

```json
{
  "auc": 0.912,
  "predictions": [ ... ],
  "interpretation": "Modelo XGBoost â€“ buena separaciÃ³n."
}
```

#### Ejemplo â€“ Falla

```json
{
  "error": "HTTP 500 Server Error: â€¦",
  "status_code": 500
}
```

---

## 1.5 Dashboards de Cola y Workers

| **Endpoint**                  | **Uso**                                                          | **Ejemplo** |
| ----------------------------- | ---------------------------------------------------------------- | ----------- |
| `GET /taskadmin/queue/stats`  | Resumen: cantidades en cola / completadas / fallidas por cola + trabajo mÃ¡s antiguo | `GET /api/v1/taskadmin/queue/stats` |
| `GET /taskadmin/queue/queued` | Volcado paginado para dashboards personalizados                   | `GET /api/v1/taskadmin/queue/queued?queue=medium` |

> ğŸ§  Ambos endpoints consultan Cosmos DB â€“ sin carga en los workers.

---

## 1.6 APIs de Uso / FacturaciÃ³n

| Endpoint                       | DescripciÃ³n                          |
| ------------------------------ | ------------------------------------ |
| `GET /taskadmin/usage/month`   | NÃºmero de llamadas y costo del mes   |
| `GET /taskadmin/usage/history` | Historial de uso y costo por mes     |

#### Ejemplo de Respuesta

```json
{
  "month": "2025-05",
  "calls": 842,
  "cost": 42.10
}
```

> ğŸ’° Los costos se derivan de `UsageRecord.cost`. Puedes definir precios por ruta.

---

## 1.7 Ciclo TÃ­pico

```
sequenceDiagram
    Customer ->> Proxy /ai/... : POST payload
    Proxy ->> Cosmos DB : Save task (status="queued")
    Proxy ->> Azure Service Bus : Enqueue task
    Celery Worker ->> Azure Bus : Poll
    Worker ->> AI Backend : POST for processing
    Worker ->> Cosmos DB : Save (status="completed" + response)
    Customer ->> /taskadmin/tasks/{id}?part=response : Fetch result
```

---

## 1.8 GuÃ­a RÃ¡pida de Manejo de Errores

| **Status**  | **Significado**          | **PrÃ³ximo Paso**                           |
| ----------- | ------------------------ | ------------------------------------------- |
| `queued`    | Esperando un worker libre | Revisa `/queue/stats` para ver el backlog   |
| `completed` | Resultado listo           | DescÃ¡rgalo                                  |
| `failed`    | Error o timeout           | Revisa el campo `error`; reintenta si es transitorio |

---

## 1.9 FAQ

* **Â¿CuÃ¡nto tiempo se conservan los resultados?**
  â³ 30 dÃ­as (por defecto)

* **Â¿Puedo cancelar un trabajo?**
  âŒ AÃºn no â€“ abre un ticket de soporte

* **Â¿Timeouts?**
  â±ï¸ Timeout fijo de 60â€¯s; divide trabajos grandes

* **Â¿Seguridad?**
  ğŸ” TLS 1.2 para todos los datos en trÃ¡nsito
  ğŸ”’ Secretos con hash en reposo

---
